### 数据库设计

user表(用户信息表)

|字段|名称|数据类型|字段作用|约束|是否建索引|
| --- | --- | --- | --- |---| --- |
|id|用户id|int|标识每一个用户|非空, 自增|主键索引|
|username|用户名|varchar(50)|用户在社区的名字|无, 默认为NULL|yes|
|password|用户密码|varchar(50)|用户的账号密码|无, 默认为NULL|no|
|salt|盐|varchar(50)|添加在用户原密码之后,然后进行md5加密, 再存储到数据库中|无, 默认为NULL|no|
|email|用户邮箱|varchar(100)|用户激活账号|无, 默认为NULL|no|
|type|类型|int|表示用户类型|无, 默认为NULL|no|
|status|用户账号状态|int|标识用户是否激活, 未激活-0, 已激活-1|无, 默认为NULL|no|
|activation_code|激活码|varchar(100)|用来激活账号|无, 默认为NULL|no|
|header_url|用户头像的url|varchar(200)|用户头像的统一资源定位符, 标识用户头像的地址|无, 默认为NULL|no|
|create_time|账号的创建时间|timestamp|记录用户账号的创建时间|无, 默认为NULL|no|

注: 对user的前 20 个前缀字符建立索引, 减少索引文件的大小, 提高查找效率.

建表语句如下:

```sql
CREATE TABLE `user` (
  `id` int NOT NULL AUTO_INCREMENT,
  `username` varchar(50) DEFAULT NULL,
  `password` varchar(50) DEFAULT NULL,
  `salt` varchar(50) DEFAULT NULL,
  `email` varchar(100) DEFAULT NULL,
  `type` int DEFAULT NULL COMMENT '0-普通用户; 1-超级管理员; 2-版主;',
  `status` int DEFAULT NULL COMMENT '0-未激活; 1-已激活;',
  `activation_code` varchar(100) DEFAULT NULL,
  `header_url` varchar(200) DEFAULT NULL,
  `create_time` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_username` (`username`(20)),
) ENGINE=InnoDB AUTO_INCREMENT=101 DEFAULT CHARSET=utf8;
```



comment表 (评论表)

| 字段        | 名称     | 数据类型  | 字段作用                                 | 约束           | 是否建索引 |
| ----------- | -------- | --------- | ---------------------------------------- | -------------- | ---------- |
| id          | 评论 id  | int       | 标识每一条评论                           | 非空, 自增     | 主键索引   |
| user_id     | 用户 id  | int       | 标识发表评论的人的id                     | 无, 默认为NULL | yes        |
| entity_type | 实体类型 | int       | 标识评论的具体实体的类别 1- 帖子, 2-评论 | 无, 默认为NULL | no         |
| entity_id   | 实体     | int       | 标识评论的具体实体的 id                  | 无, 默认为NULL | yes        |
| target_id   | 目标 id  | int       | 标识具体回复的某个人的 id                | 无, 默认为NULL | no         |
| content     | 内容     | text      | 评论的具体内容                           | 无             | no         |
| status      | 状态     | int       | 评论的具体状态                           | 无, 默认为NULL | no         |
| create_time | 发表时间 | timestamp | 评论的发表时间                           | 无, 默认为NULL | no         |



建表语句如下:

```sql
CREATE TABLE `comment` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int DEFAULT NULL,
  `entity_type` int DEFAULT NULL,
  `entity_id` int DEFAULT NULL,
  `target_id` int DEFAULT NULL,
  `content` text,
  `status` int DEFAULT NULL,
  `create_time` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_user_id` (`user_id`),
  KEY `index_entity_id` (`entity_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```



帖子表:

| 字段          | 名称     | 数据类型  | 字段作用         | 约束           | 是否建索引 |
| ------------- | -------- | --------- | ---------------- | -------------- | ---------- |
| id            | 帖子 id  | int       | 标识每一个帖子   | 非空, 自增     | 主键索引   |
| user_id       | 用户 id  | int       | 发帖人的 id      | 无, 默认为NULL | yes        |
| title         | 标题     | varchar   | 帖子标题         | 无, 默认为NULL | no         |
| content       | 内容     | text      | 帖子的具体内容   | 无             | no         |
| create_time   | 发布时间 | timestamp | 帖子的发表时间   | 无, 默认为NULL | no         |
| comment_count | 评论数量 | int       | 统计帖子的评论数 | 无, 默认为NULL | no         |

建表语句如下:

```sql
CREATE TABLE `discuss_post` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int DEFAULT NULL,
  `title` varchar(100) DEFAULT NULL,
  `content` text,
  `create_time` timestamp NULL DEFAULT NULL,
  `comment_count` int DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```















### 接口定义

| 接口地址                              | 功能                            | 请求方式 |
| ------------------------------------- | ------------------------------- | -------- |
| /community/login                      | 跳转到登录界面                  | get      |
| /community/register                   | 跳转到用户注册界面              | get      |
| /community/register                   | 用户注册                        | post     |
| /community/activation/{userId}/{code} | 用户激活                        | GET      |
| /community/kaptcha                    | 获取验证码                      | get      |
| community/login                       | 用户登录                        | post     |
| /community/logout                     | 用户退出登录, 重定向到登录界面  | get      |
| /community/user/setting               | 跳转到用户账号设置界面          | get      |
| /community/user/upload                | 用户上传账号头像                | post     |
| /community/header/{fileName}          | 获取用户头像                    | get      |
| /community/profile/{userId}           | 跳转到用户个人主页              | get      |
| /community/like                       | 给某一实体点赞 (帖子, 评论....) |          |
|                                       |                                 |          |
|                                       |                                 |          |
| community/                            |                                 |          |
|                                       |                                 |          |
|                                       |                                 |          |
|                                       |                                 |          |
|                                       |                                 |          |





​    

